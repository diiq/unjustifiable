"use strict";var unjustifiable,_extends=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};unjustifiable=function(a){a=_extends({hyphenator:function(e){return[e]},stretch:15,shrink:-1,overhang:20,hyphenPenalty:1e3},a||{});var e=function(t){return function(e){var n=document.createElement("span");return n.className=t,e&&(n.innerHTML=e),n}},i=e("glue"),o=e("box"),c=(e("punctuation"),e("penalty")),l=/(&nbsp;|(?:&mdash;|&rdquo;|[-,;:"”=\.\/\)\]\}\?])+(?:&nbsp;)*)/,s=function(e){var n=(e=e.replace(/\n ?/g," ").replace(/ +/g,"&nbsp;")).split(l).map(function(e,n){return e.match(l)?[i(e)," "]:e?(t=e,r=a.hyphenator(t),o(r[0]),u=[],r.forEach(function(e,n){0<n&&u.push(c()),u.push(o(e))}),u):"";var t,r,u});return[].concat.apply([],n)},p=function n(e,t){return Array.from(e.children).forEach(function(e){(function(e,n){if(e.hasAttribute("class"))return-1<e.getAttribute("class").indexOf(n)})(e,"unjustifiable-ignore")||(e.children.length?n(e,t):t(e))})},h=function(e,n){return e.map(function(e){return e[n]||0}).reduce(function(e,n){return e+n},0)},f=function(i,o,e,a){var c=[],l=null;return e.forEach(function(e){var n=a[e.lineNumber],t=function(e,n,t){for(var r=e.slice(n,t);r.length&&"glue"===r[0].type;)r=r.slice(1);for(var u=h(r,"width");r.length&&"glue"===r[r.length-1].type;)r.pop();return{width:u,stretch:h(r,"stretch"),shrink:h(r,"shrink"),glues:r.filter(function(e){return"glue"===e.type}).length}}(i,e.index,o),r=n-t.width;if(o===i.length-1&&(r=Math.min(r,0)),r>=t.shrink&&r<=t.stretch){var u=e.cost;u+=Math.pow(r,2),"penalty"===i[o].type&&(u+=i[o].cost),u+=Math.pow(e.compression-r,2),(!l||u<=l.cost)&&(l={wordlet:i[o],cost:u,compression:r,width:t.width,glues:t.glues,index:o,previous:e,lineNumber:e.lineNumber+1})}t.width+t.shrink<n&&o<i.length-1&&c.push(e)}),l&&c.push(l),c},d=function(e){for(var n=[{gluesSoFar:0,spacing:0,firstCount:100}];e.previous;){var t=e.compression/e.glues;n.push({breakElement:e.wordlet.span,spacing:t}),e=e.previous}return n},g=function(e,c){if(!c)return n(e);var t=null,l=function(e){var n=document.createElement("span");n.style.wordSpacing=e.spacing+"px",t=n},s=function(e){return e.push(t)},p=function(e){return t.innerHTML+=e},h=c[c.length-1];e.parentNode.replaceChild(function o(e){var a=[];l(h),Array.from(e.children).forEach(function(e){if(e.children.length)s(a),a.push(o(e)),l(h);else{var n=e.innerHTML;h&&e===h.breakElement?("penalty"===e.getAttribute("class")?(s(a),u=a,(i=document.createElement("span")).innerText="-",i.style.userSelect="none",u.push(i)):(p(n),s(a)),t=a,(r=document.createElement("br")).setAttribute("aria-hidden","true"),r.style.userSelect="none",t.push(r),c.pop(),h=c[c.length-1],l(h)):"box"===e.getAttribute("class")?p(n):"glue"===e.getAttribute("class")&&p(n.replace("&nbsp;"," "))}var t,r,u,i}),s(a);var n=e.cloneNode(!1);return n.innerHTML="",n.append.apply(n,a),n}(e),e)},n=function(e){e.parentNode.replaceChild(function t(e){var r=[];Array.from(e.children).forEach(function(e){var n;e.children.length?r.push(t(e)):(n=e.innerHTML.replace("&nbsp;"," "),r.push(n))});var n=e.cloneNode(!1);return n.innerHTML="",n.append.apply(n,r),n}(e),e)};return function(e){var n,t,r,u,i,o;(e=function n(e){var t=e.childNodes,r=[];t.forEach(function(e){3===e.nodeType?r=r.concat(s(e.textContent)):r.push(n(e))});var u=e.cloneNode(!1);return u.innerHTML="",u.append.apply(u,r),e.parentNode.replaceChild(u,e),u}(e)).style.textAlign="justify",r=[],u=0,i=null,p(e,function(e){var n=e.getClientRects()[0];return i&&2<n.top-i.top&&(r.push(i.right-u-a.overhang),u=n.left),i||(u=n.left),i=n}),(t=r).push(t[t.length-1]),e.style.textAlign="left",o=[],p(e,function(e){var n={type:e.getAttribute("class"),span:e,width:e.getClientRects()[0].width};return"glue"===n.type&&e.innerHTML.match("&nbsp;")?(n.stretch=a.stretch,n.shrink=a.shrink):"penalty"===n.type&&(n.cost=a.hyphenPenalty,n.width=0),o.push(n)}),n=function(t,r){var u=[{wordlet:{},cost:0,compression:0,index:0,previous:null,lineNumber:0}];t.push({type:"glue",width:0}),t.forEach(function(e,n){"penalty"!==e.type&&"glue"!==e.type||(u=f(t,n,u,r))});var e,n,i,o,a,c=(e=u.reverse(),n=function(e){return e.cost},o=null,a=1/0,e.forEach(function(e){(i=n(e))<a&&(o=e,a=i)}),o);if(c)return d(c)}(o,t),g(e,n)}},window.unjustifiable=unjustifiable;
