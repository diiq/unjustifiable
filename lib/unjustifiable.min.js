"use strict";var unjustifiable,_extends=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n};unjustifiable=function(o){o=_extends({hyphenator:function(n){return[n]},stretch:15,shrink:-1,overhang:20,hyphenPenalty:1e3},o||{});var n=function(t){return function(n){var e=document.createElement("span");return e.className=t,n&&(e.innerHTML=n),e}},u=n("glue"),a=n("box"),c=(n("punctuation"),n("penalty")),l=/(&nbsp;|(?:&mdash;|&rdquo;|[-,;:"”=\.\/\)\]\}\?])+(?:&nbsp;)*)/,s=function(n){var e=(n=n.replace(/\n ?/g," ").replace(/ +/g,"&nbsp;")).split(l).map(function(n,e){return n.match(l)?[u(n)," "]:n?(t=n,r=o.hyphenator(t),a(r[0]),i=[],r.forEach(function(n,e){0<e&&i.push(c()),i.push(a(n))}),i):"";var t,r,i});return[].concat.apply([],e)},p=function e(n,t){return Array.from(n.children).forEach(function(n){(function(n,e){if(n.hasAttribute("class"))return-1<n.getAttribute("class").indexOf(e)})(n,"unjustifiable-ignore")||(n.children.length?e(n,t):t(n))})},h=function(n,e){return n.map(function(n){return n[e]||0}).reduce(function(n,e){return n+e},0)},f=function(u,a,n,o){var c=[],l=null;return n.forEach(function(n){var e=o[n.lineNumber],t=function(n,e,t){for(var r=n.slice(e,t);r.length&&"glue"===r[0].type;)r=r.slice(1);for(var i=h(r,"width");r.length&&"glue"===r[r.length-1].type;)r.pop();return{width:i,stretch:h(r,"stretch"),shrink:h(r,"shrink"),glues:r.filter(function(n){return"glue"===n.type}).length}}(u,n.index,a),r=e-t.width;if(a===u.length-1&&(r=Math.min(r,0)),r>=t.shrink&&r<=t.stretch){var i=n.cost;i+=Math.pow(r,2),"penalty"===u[a].type&&(i+=u[a].cost),i+=Math.pow(n.compression-r,2),(!l||i<=l.cost)&&(l={wordlet:u[a],cost:i,compression:r,width:t.width,glues:t.glues,index:a,previous:n,lineNumber:n.lineNumber+1})}t.width+t.shrink<e&&a<u.length-1&&c.push(n)}),l&&c.push(l),c},d=function(n){for(var e=[{gluesSoFar:0,spacing:0,firstCount:100}];n.previous;){var t=n.compression/n.glues;e.push({breakElement:n.wordlet.span,spacing:t}),n=n.previous}return e},g=function(n,a){if(!a)return e(n);var t=null,o=function(n){var e=document.createElement("span");e.style.wordSpacing=n.spacing+"px",t=e},c=function(n){return n.push(t)},l=function(n){return t.innerHTML+=n},s=a[a.length-1];n.parentNode.replaceChild(function i(n){var u=[];o(s),Array.from(n.children).forEach(function(n){if(n.children.length)c(u),u.push(i(n)),o(s);else{var e=n.innerHTML;s&&n===s.breakElement?("penalty"===n.getAttribute("class")&&l("-"),l(e),c(u),t=u,(r=document.createElement("br")).setAttribute("aria-hidden","true"),t.push(r),a.pop(),s=a[a.length-1],o(s)):"box"===n.getAttribute("class")?l(e):"glue"===n.getAttribute("class")&&l(e.replace("&nbsp;"," "))}var t,r}),c(u);var e=n.cloneNode(!1);return e.innerHTML="",e.append.apply(e,u),e}(n),n)},e=function(n){n.parentNode.replaceChild(function t(n){var r=[];Array.from(n.children).forEach(function(n){var e;n.children.length?r.push(t(n)):(e=n.innerHTML.replace("&nbsp;"," "),r.push(e))});var e=n.cloneNode(!1);return e.innerHTML="",e.append.apply(e,r),e}(n),n)};return function(n){var e,t,r,i,u,a;(n=function e(n){var t=n.childNodes,r=[];t.forEach(function(n){3===n.nodeType?r=r.concat(s(n.textContent)):r.push(e(n))});var i=n.cloneNode(!1);return i.innerHTML="",i.append.apply(i,r),n.parentNode.replaceChild(i,n),i}(n)).style.textAlign="justify",r=[],i=0,u=null,p(n,function(n){var e=n.getClientRects()[0];return u&&2<e.top-u.top&&(r.push(u.right-i-o.overhang),i=e.left),u||(i=e.left),u=e}),(t=r).push(t[t.length-1]),n.style.textAlign="left",a=[],p(n,function(n){var e={type:n.getAttribute("class"),span:n,width:n.getClientRects()[0].width};return"glue"===e.type&&n.innerHTML.match("&nbsp;")?(e.stretch=o.stretch,e.shrink=o.shrink):"penalty"===e.type&&(e.cost=o.hyphenPenalty,e.width=0),a.push(e)}),e=function(t,r){var i=[{wordlet:{},cost:0,compression:0,index:0,previous:null,lineNumber:0}];t.push({type:"glue",width:0}),t.forEach(function(n,e){"penalty"!==n.type&&"glue"!==n.type||(i=f(t,e,i,r))});var n,e,u,a,o,c=(n=i.reverse(),e=function(n){return n.cost},a=null,o=1/0,n.forEach(function(n){(u=e(n))<o&&(a=n,o=u)}),a);if(c)return d(c)}(a,t),g(n,e)}},window.unjustifiable=unjustifiable;
