"use strict";var unjustifiable,_extends=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};unjustifiable=function(o){o=_extends({hyphenator:function(e){return[e]},stretch:15,shrink:-1,overhang:20,hyphenPenalty:1e3},o||{});var e=function(t){return function(e){var n=document.createElement("span");return n.className=t,e&&(n.innerHTML=e),n}},i=e("glue"),a=e("box"),c=(e("punctuation"),e("penalty")),s=/(&nbsp;|(?:&mdash;|&rdquo;|[-,;:"”=\.\/\)\]\}\?])+(?:&nbsp;)*)/,l=function(e){var n=(e=e.replace(/\n ?/g," ").replace(/ +/g,"&nbsp;")).split(s).map(function(e,n){return e.match(s)?[i(e)," "]:e?(t=e,r=o.hyphenator(t),a(r[0]),u=[],r.forEach(function(e,n){0<n&&u.push(c()),u.push(a(e))}),u):"";var t,r,u});return[].concat.apply([],n)},p=function n(e,t){return Array.from(e.children).forEach(function(e){(function(e,n){if(e.hasAttribute("class"))return-1<e.getAttribute("class").indexOf(n)})(e,"unjustifiable-ignore")||(e.children.length?n(e,t):t(e))})},h=function(e,n){return e.map(function(e){return e[n]||0}).reduce(function(e,n){return e+n},0)},f=function(i,a,e,o){var c=[],s=null;return e.forEach(function(e){var n=o[e.lineNumber],t=function(e,n,t){for(var r=e.slice(n,t);r.length&&"glue"===r[0].type;)r=r.slice(1);for(var u=h(r,"width");r.length&&"glue"===r[r.length-1].type;)r.pop();return{width:u,stretch:h(r,"stretch"),shrink:h(r,"shrink"),glues:r.filter(function(e){return"glue"===e.type}).length}}(i,e.index,a),r=n-t.width;if(a===i.length-1&&(r=Math.min(r,0)),r>=t.shrink&&r<=t.stretch){var u=e.cost;u+=Math.pow(r,2),"penalty"===i[a].type&&(u+=i[a].cost),u+=Math.pow(e.compression-r,2),(!s||u<=s.cost)&&(s={wordlet:i[a],cost:u,compression:r,width:t.width,glues:t.glues,index:a,previous:e,lineNumber:e.lineNumber+1})}t.width+t.shrink<n&&a<i.length-1&&c.push(e)}),s&&c.push(s),c},d=function(e){for(var n=[{gluesSoFar:0,spacing:0,firstCount:100}];e.previous;){var t=e.compression/e.glues;n.push({breakElement:e.wordlet.span,spacing:t}),e=e.previous}return n},g=function(e,c){if(!c)return n(e);var t=null,s=function(e){var n=document.createElement("span");n.style.wordSpacing=e.spacing+"px",t=n},l=function(e){return e.push(t)},p=function(e){return t.innerHTML+=e},h=c[c.length-1];e.parentNode.replaceChild(function a(e){var o=[];s(h),Array.from(e.children).forEach(function(e){if(e.children.length)l(o),o.push(a(e)),s(h);else{var n=e.innerHTML;h&&e===h.breakElement?("penalty"===e.getAttribute("class")?(l(o),u=o,(i=document.createElement("span")).innerText="-",i.style.userSelect="none",u.push(i)):(p(n),l(o)),t=o,(r=document.createElement("br")).setAttribute("aria-hidden","true"),r.style.userSelect="none",t.push(r),c.pop(),h=c[c.length-1],s(h)):"box"===e.getAttribute("class")?p(n):"glue"===e.getAttribute("class")?p(n.replace("&nbsp;"," ")):o.push(e)}var t,r,u,i}),l(o);var n=e.cloneNode(!1);return n.innerHTML="",n.append.apply(n,o),n}(e),e)},n=function(e){e.parentNode.replaceChild(function t(e){var r=[];Array.from(e.children).forEach(function(e){var n;e.children.length?r.push(t(e)):0<=["penalty","box","glue"].indexOf(e.getAttribute("class"))?(n=e.innerHTML.replace("&nbsp;"," "),r.push(n)):r.push(e)});var n=e.cloneNode(!1);return n.innerHTML="",n.append.apply(n,r),n}(e),e)};return function(e){var n,t,r,u,i,a;(e=function n(e){var t=e.childNodes,r=[];t.forEach(function(e){3===e.nodeType?r=r.concat(l(e.textContent)):r.push(n(e))});var u=e.cloneNode(!1);return u.innerHTML="",u.append.apply(u,r),e.parentNode.replaceChild(u,e),u}(e)).style.textAlign="justify",r=[],u=0,i=null,p(e,function(e){var n=e.getClientRects()[0];return i&&2<n.top-i.top&&(r.push(i.right-u-o.overhang),u=n.left),i||(u=n.left),i=n}),(t=r).push(t[t.length-1]),e.style.textAlign="left",a=[],p(e,function(e){var n={type:e.getAttribute("class"),span:e,width:e.getClientRects()[0].width};return"glue"===n.type&&e.innerHTML.match("&nbsp;")?(n.stretch=o.stretch,n.shrink=o.shrink):"penalty"===n.type&&(n.cost=o.hyphenPenalty,n.width=0),a.push(n)}),n=function(t,r){var u=[{wordlet:{},cost:0,compression:0,index:0,previous:null,lineNumber:0}];t.push({type:"glue",width:0}),t.forEach(function(e,n){"penalty"!==e.type&&"glue"!==e.type||(u=f(t,n,u,r))});var e,n,i,a,o,c=(e=u.reverse(),n=function(e){return e.cost},a=null,o=1/0,e.forEach(function(e){(i=n(e))<o&&(a=e,o=i)}),a);if(c)return d(c)}(a,t),g(e,n)}},window.unjustifiable=unjustifiable;
